<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Naya Voice Assistant</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .test-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            max-width: 600px;
            width: 100%;
            text-align: center;
        }

        h1 {
            color: #333;
            margin-bottom: 30px;
            font-size: 28px;
        }

        .test-section {
            margin: 30px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #ff7200;
        }

        .test-button {
            background: #ff7200;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s ease;
        }

        .test-button:hover {
            background: #e65a00;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 114, 0, 0.3);
        }

        .status {
            margin: 15px 0;
            padding: 10px;
            border-radius: 5px;
            font-weight: bold;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .feature-list {
            text-align: right;
            margin: 20px 0;
        }

        .feature-list li {
            margin: 10px 0;
            padding: 5px 0;
        }

        .voice-indicator {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: #ff7200;
            margin: 20px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
        }

        .voice-indicator.listening {
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 114, 0, 0.7); }
            70% { transform: scale(1.05); box-shadow: 0 0 0 10px rgba(255, 114, 0, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 114, 0, 0); }
        }

        .console-output {
            background: #000;
            color: #00ff00;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            text-align: left;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ¤ Ø§Ø®ØªØ¨Ø§Ø± Naya Voice Assistant</h1>

        <div class="test-section">
            <h3>Ø§Ø®ØªØ¨Ø§Ø± Ø¯Ø¹Ù… Ø§Ù„Ù…ØªØµÙØ­</h3>
            <button class="test-button" onclick="testBrowserSupport()">ÙØ­Øµ Ø¯Ø¹Ù… Ø§Ù„Ù…ØªØµÙØ­</button>
            <div id="browserStatus" class="status" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h3>Ø§Ø®ØªØ¨Ø§Ø± Ø¥Ø°Ù† Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†</h3>
            <button class="test-button" onclick="testMicrophonePermission()">Ø·Ù„Ø¨ Ø¥Ø°Ù† Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†</button>
            <div id="micStatus" class="status" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h3>Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØª</h3>
            <div class="voice-indicator" id="voiceIndicator">ğŸ¤</div>
            <button class="test-button" id="voiceTestBtn" onclick="testVoiceRecognition()">Ø¨Ø¯Ø¡ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØµÙˆØª</button>
            <div id="voiceStatus" class="status" style="display: none;"></div>
            <div id="recognizedText" style="margin-top: 15px; font-weight: bold;"></div>
        </div>

        <div class="test-section">
            <h3>Ø§Ø®ØªØ¨Ø§Ø± ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù†Øµ Ø¥Ù„Ù‰ ÙƒÙ„Ø§Ù…</h3>
            <button class="test-button" onclick="testTextToSpeech()">Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù†Ø·Ù‚ Ø§Ù„Ø¹Ø±Ø¨ÙŠ</button>
            <button class="test-button" onclick="testFemaleVoice()">Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØµÙˆØª Ø§Ù„Ø£Ù†Ø«ÙˆÙŠ</button>
            <button class="test-button" onclick="listAvailableVoices()">Ø¹Ø±Ø¶ Ø§Ù„Ø£ØµÙˆØ§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©</button>
            <button class="test-button" onclick="showVoiceSelector()">Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØª Ù…Ø®ØµØµ</button>
            <button class="test-button" onclick="testStopCommand()">Ø§Ø®ØªØ¨Ø§Ø± Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù</button>
            <button class="test-button" onclick="testVoiceQuality()">Ø§Ø®ØªØ¨Ø§Ø± Ø¬ÙˆØ¯Ø© Ø§Ù„ØµÙˆØª Ø§Ù„Ù…Ø­Ø³Ù†Ø©</button>
            <button class="test-button" onclick="testFastResponse()">Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø§Ù„Ø³Ø±ÙŠØ¹Ø©</button>
            <button class="test-button" onclick="testAntiRepeat()">Ø§Ø®ØªØ¨Ø§Ø± Ù…Ù†Ø¹ Ø§Ù„ØªÙƒØ±Ø§Ø±</button>
            <button class="test-button" onclick="testNavigationCommands()">Ø§Ø®ØªØ¨Ø§Ø± Ø£ÙˆØ§Ù…Ø± Ø§Ù„ØªÙ†Ù‚Ù„</button>
            <button class="test-button" onclick="testVariedResponses()">Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø±Ø¯ÙˆØ¯ Ø§Ù„Ù…ØªÙ†ÙˆØ¹Ø©</button>
            <div id="speechStatus" class="status" style="display: none;"></div>
            <div id="voicesList" style="margin-top: 15px; text-align: right; font-size: 12px;"></div>
        </div>

        <div class="test-section">
            <h3>Ø§Ø®ØªØ¨Ø§Ø± ØªÙØ¹ÙŠÙ„ Naya</h3>
            <button class="test-button" onclick="testNayaActivation()">ØªÙØ¹ÙŠÙ„ Naya ÙŠØ¯ÙˆÙŠØ§Ù‹</button>
            <button class="test-button" onclick="simulateVoiceCommand()">Ù…Ø­Ø§ÙƒØ§Ø© Ø£Ù…Ø± ØµÙˆØªÙŠ</button>
            <div id="nayaStatus" class="status" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h3>Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù…Ø¯Ø¹ÙˆÙ…Ø© Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±</h3>
            <ul class="feature-list">
                <li>"naya" Ø£Ùˆ "Ù†Ø§ÙŠØ§" - Ù„Ù„ØªÙØ¹ÙŠÙ„</li>
                <li>"hello" Ø£Ùˆ "Ù…Ø±Ø­Ø¨Ø§" - Ù„Ù„ØªØ±Ø­ÙŠØ¨</li>
                <li>"time" Ø£Ùˆ "Ø§Ù„ÙˆÙ‚Øª" - Ù„Ù…Ø¹Ø±ÙØ© Ø§Ù„ÙˆÙ‚Øª</li>
                <li>"close" Ø£Ùˆ "Ø¥ØºÙ„Ø§Ù‚" - Ù„Ù„Ø¥ØºÙ„Ø§Ù‚</li>
                <li>F1 - ØªÙØ¹ÙŠÙ„ ÙŠØ¯ÙˆÙŠ</li>
                <li>F2 - Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…</li>
            </ul>
        </div>

        <div class="test-section">
            <h3>Ø­Ù„ Ù…Ø´ÙƒÙ„Ø© "aborted" error</h3>
            <ul class="feature-list">
                <li>âœ… Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠØ¹ÙŠØ¯ Ø§Ù„ØªØ´ØºÙŠÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ Ø­Ø¯ÙˆØ« Ø®Ø·Ø£ "aborted"</li>
                <li>âœ… Ù…Ø±Ø§Ù‚Ø¨Ø© Ø¯ÙˆØ±ÙŠØ© Ù„Ù„Ù†Ø¸Ø§Ù… ÙƒÙ„ 15 Ø«Ø§Ù†ÙŠØ©</li>
                <li>âœ… ÙØ­Øµ ØµØ­Ø© Ø§Ù„Ù†Ø¸Ø§Ù… ÙƒÙ„ 30 Ø«Ø§Ù†ÙŠØ©</li>
                <li>âœ… Ø¥Ø¹Ø§Ø¯Ø© Ù…Ø­Ø§ÙˆÙ„Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ© Ø¹Ù†Ø¯ ÙØ´Ù„ Ø§Ù„ØªØ´ØºÙŠÙ„</li>
                <li>âš ï¸ Ø¥Ø°Ø§ Ø§Ø³ØªÙ…Ø± Ø§Ù„Ø®Ø·Ø£ØŒ Ø§Ø¶ØºØ· F2 Ù„Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ´ØºÙŠÙ„ ÙŠØ¯ÙˆÙŠØ§Ù‹</li>
            </ul>
        </div>

        <div class="test-section">
            <h3>Ø³Ø¬Ù„ ÙˆØ­Ø¯Ø© Ø§Ù„ØªØ­ÙƒÙ…</h3>
            <button class="test-button" onclick="clearConsole()">Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„</button>
            <div id="consoleOutput" class="console-output"></div>
        </div>
    </div>

    <script>
        let recognition = null;
        let isListening = false;
        let consoleOutput = [];

        // ØªØ³Ø¬ÙŠÙ„ Ø±Ø³Ø§Ø¦Ù„ ÙˆØ­Ø¯Ø© Ø§Ù„ØªØ­ÙƒÙ…
        const originalLog = console.log;
        const originalError = console.error;

        console.log = function(...args) {
            originalLog.apply(console, args);
            addToConsole('LOG: ' + args.join(' '));
        };

        console.error = function(...args) {
            originalError.apply(console, args);
            addToConsole('ERROR: ' + args.join(' '));
        };

        function addToConsole(message) {
            consoleOutput.push(new Date().toLocaleTimeString() + ' - ' + message);
            updateConsoleDisplay();
        }

        function updateConsoleDisplay() {
            const consoleDiv = document.getElementById('consoleOutput');
            consoleDiv.innerHTML = consoleOutput.slice(-20).join('<br>');
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        }

        function clearConsole() {
            consoleOutput = [];
            updateConsoleDisplay();
        }

        function testBrowserSupport() {
            const statusDiv = document.getElementById('browserStatus');
            statusDiv.style.display = 'block';

            const speechSupport = 'webkitSpeechRecognition' in window || 'SpeechRecognition' in window;
            const synthesisSupport = 'speechSynthesis' in window;
            const mediaSupport = 'mediaDevices' in navigator;

            if (speechSupport && synthesisSupport && mediaSupport) {
                statusDiv.className = 'status success';
                statusDiv.textContent = 'âœ… Ø§Ù„Ù…ØªØµÙØ­ ÙŠØ¯Ø¹Ù… Ø¬Ù…ÙŠØ¹ Ù…ÙŠØ²Ø§Øª Naya!';
            } else {
                statusDiv.className = 'status error';
                statusDiv.textContent = 'âŒ Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ø¨Ø¹Ø¶ Ù…ÙŠØ²Ø§Øª Naya';
            }

            console.log('Browser support check:', {
                speechRecognition: speechSupport,
                speechSynthesis: synthesisSupport,
                mediaDevices: mediaSupport
            });
        }

        async function testMicrophonePermission() {
            const statusDiv = document.getElementById('micStatus');
            statusDiv.style.display = 'block';
            statusDiv.className = 'status info';
            statusDiv.textContent = 'ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø·Ù„Ø¨ Ø¥Ø°Ù† Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†...';

            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                stream.getTracks().forEach(track => track.stop());

                statusDiv.className = 'status success';
                statusDiv.textContent = 'âœ… ØªÙ… Ù…Ù†Ø­ Ø¥Ø°Ù† Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ† Ø¨Ù†Ø¬Ø§Ø­!';
                console.log('Microphone permission granted');
            } catch (error) {
                statusDiv.className = 'status error';
                statusDiv.textContent = 'âŒ ØªÙ… Ø±ÙØ¶ Ø¥Ø°Ù† Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†: ' + error.message;
                console.error('Microphone permission denied:', error);
            }
        }

        function testVoiceRecognition() {
            const statusDiv = document.getElementById('voiceStatus');
            const indicator = document.getElementById('voiceIndicator');
            const button = document.getElementById('voiceTestBtn');
            const textDiv = document.getElementById('recognizedText');

            if (!('webkitSpeechRecognition' in window || 'SpeechRecognition' in window)) {
                statusDiv.style.display = 'block';
                statusDiv.className = 'status error';
                statusDiv.textContent = 'âŒ Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØª';
                return;
            }

            if (isListening) {
                recognition.stop();
                return;
            }

            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            recognition = new SpeechRecognition();

            recognition.continuous = false;
            recognition.interimResults = false;
            recognition.lang = 'ar-SA';

            recognition.onstart = function() {
                isListening = true;
                indicator.classList.add('listening');
                button.textContent = 'Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹';
                statusDiv.style.display = 'block';
                statusDiv.className = 'status info';
                statusDiv.textContent = 'ğŸ¤ Ø£Ø³ØªÙ…Ø¹ Ø¥Ù„ÙŠÙƒ Ø§Ù„Ø¢Ù†...';
                textDiv.textContent = '';
                console.log('Voice recognition started');
            };

            recognition.onresult = function(event) {
                const transcript = event.results[0][0].transcript;
                textDiv.textContent = `Ø§Ù„Ù†Øµ Ø§Ù„Ù…ÙØªØ¹Ø±Ù Ø¹Ù„ÙŠÙ‡: "${transcript}"`;
                statusDiv.className = 'status success';
                statusDiv.textContent = 'âœ… ØªÙ… Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØª Ø¨Ù†Ø¬Ø§Ø­!';
                console.log('Voice recognized:', transcript);
            };

            recognition.onerror = function(event) {
                statusDiv.className = 'status error';
                statusDiv.textContent = `âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØª: ${event.error}`;
                console.error('Voice recognition error:', event.error);
            };

            recognition.onend = function() {
                isListening = false;
                indicator.classList.remove('listening');
                button.textContent = 'Ø¨Ø¯Ø¡ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØµÙˆØª';
                console.log('Voice recognition ended');
            };

            recognition.start();
        }

        function testTextToSpeech() {
            const statusDiv = document.getElementById('speechStatus');
            statusDiv.style.display = 'block';

            if (!('speechSynthesis' in window)) {
                statusDiv.className = 'status error';
                statusDiv.textContent = 'âŒ Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù†Øµ Ø¥Ù„Ù‰ ÙƒÙ„Ø§Ù…';
                return;
            }

            const utterance = new SpeechSynthesisUtterance('Ù…Ø±Ø­Ø¨Ø§Ù‹! Ù‡Ø°Ø§ Ø§Ø®ØªØ¨Ø§Ø± Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù†Øµ Ø¥Ù„Ù‰ ÙƒÙ„Ø§Ù… ÙÙŠ Naya Voice Assistant');
            utterance.lang = 'ar-SA';
            utterance.rate = 1;
            utterance.volume = 1;
            utterance.pitch = 1;

            utterance.onstart = function() {
                statusDiv.className = 'status info';
                statusDiv.textContent = 'ğŸ”Š Ø¬Ø§Ø±ÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª...';
                console.log('Speech synthesis started');
            };

            utterance.onend = function() {
                statusDiv.className = 'status success';
                statusDiv.textContent = 'âœ… ØªÙ… ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª Ø¨Ù†Ø¬Ø§Ø­!';
                console.log('Speech synthesis ended');
            };

            utterance.onerror = function(error) {
                statusDiv.className = 'status error';
                statusDiv.textContent = 'âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª';
                console.error('Speech synthesis error:', error);
            };

            window.speechSynthesis.speak(utterance);
        }

        function testFemaleVoice() {
            const statusDiv = document.getElementById('speechStatus');
            statusDiv.style.display = 'block';

            if (!('speechSynthesis' in window)) {
                statusDiv.className = 'status error';
                statusDiv.textContent = 'âŒ Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù†Øµ Ø¥Ù„Ù‰ ÙƒÙ„Ø§Ù…';
                return;
            }

            const utterance = new SpeechSynthesisUtterance('Hello! I am Naya, your female voice assistant. Welcome to Energy AI website.');
            utterance.lang = 'en-US';
            utterance.rate = 0.9;
            utterance.volume = 0.8;
            utterance.pitch = 1.2; // Ø±ÙØ¹ Ø§Ù„Ù†Ø¨Ø±Ø© Ù„Ù„ØµÙˆØª Ø§Ù„Ø£Ù†Ø«ÙˆÙŠ

            // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† ØµÙˆØª Ø£Ù†Ø«Ù‰
            const voices = window.speechSynthesis.getVoices();
            let femaleVoice = voices.find(voice =>
                voice.lang.includes('en') &&
                (voice.name.toLowerCase().includes('female') ||
                 voice.name.toLowerCase().includes('woman') ||
                 voice.name.toLowerCase().includes('zira') ||
                 voice.name.toLowerCase().includes('hazel') ||
                 voice.name.toLowerCase().includes('susan') ||
                 voice.name.toLowerCase().includes('samantha') ||
                 voice.name.toLowerCase().includes('karen') ||
                 voice.name.toLowerCase().includes('moira') ||
                 voice.name.toLowerCase().includes('tessa') ||
                 voice.name.toLowerCase().includes('veena') ||
                 voice.name.toLowerCase().includes('fiona'))
            );

            if (!femaleVoice) {
                femaleVoice = voices.find(voice => voice.lang.includes('en'));
            }

            if (femaleVoice) {
                utterance.voice = femaleVoice;
                console.log('Using female voice:', femaleVoice.name);
                statusDiv.className = 'status info';
                statusDiv.textContent = `ğŸ”Š Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØµÙˆØª Ø§Ù„Ø£Ù†Ø«ÙˆÙŠ: ${femaleVoice.name}`;
            } else {
                console.log('No female voice found, using default voice');
                statusDiv.className = 'status info';
                statusDiv.textContent = 'ğŸ”Š Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ØµÙˆØª Ø£Ù†Ø«ÙˆÙŠØŒ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØµÙˆØª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ';
            }

            utterance.onstart = function() {
                console.log('Female voice synthesis started');
            };

            utterance.onend = function() {
                statusDiv.className = 'status success';
                statusDiv.textContent = 'âœ… ØªÙ… ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª Ø§Ù„Ø£Ù†Ø«ÙˆÙŠ Ø¨Ù†Ø¬Ø§Ø­!';
                console.log('Female voice synthesis ended');
            };

            utterance.onerror = function(error) {
                statusDiv.className = 'status error';
                statusDiv.textContent = 'âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª Ø§Ù„Ø£Ù†Ø«ÙˆÙŠ';
                console.error('Female voice synthesis error:', error);
            };

            window.speechSynthesis.speak(utterance);
        }

        function listAvailableVoices() {
            const voicesDiv = document.getElementById('voicesList');
            const voices = window.speechSynthesis.getVoices();

            if (voices.length === 0) {
                voicesDiv.innerHTML = '<p style="color: #ff7200;">â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£ØµÙˆØ§Øª...</p>';
                setTimeout(listAvailableVoices, 500);
                return;
            }

            let voicesHTML = '<h4>Ø§Ù„Ø£ØµÙˆØ§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©:</h4><ul style="text-align: right;">';

            voices.forEach((voice, index) => {
                const isFemale = voice.name.toLowerCase().includes('female') ||
                                voice.name.toLowerCase().includes('woman') ||
                                voice.name.toLowerCase().includes('zira') ||
                                voice.name.toLowerCase().includes('hazel') ||
                                voice.name.toLowerCase().includes('susan') ||
                                voice.name.toLowerCase().includes('samantha') ||
                                voice.name.toLowerCase().includes('karen') ||
                                voice.name.toLowerCase().includes('moira') ||
                                voice.name.toLowerCase().includes('tessa') ||
                                voice.name.toLowerCase().includes('veena') ||
                                voice.name.toLowerCase().includes('fiona');

                const genderIcon = isFemale ? 'ğŸ‘©' : 'ğŸ‘¤';
                const langFlag = voice.lang.includes('ar') ? 'ğŸ‡¸ğŸ‡¦' : voice.lang.includes('en') ? 'ğŸ‡ºğŸ‡¸' : 'ğŸŒ';

                voicesHTML += `<li style="margin: 5px 0; padding: 5px; background: ${isFemale ? '#ffe6f2' : '#f0f0f0'}; border-radius: 3px;">
                    ${genderIcon} ${langFlag} <strong>${voice.name}</strong> (${voice.lang})
                    ${isFemale ? '<span style="color: #ff1493; font-weight: bold;"> - Ø£Ù†Ø«Ù‰</span>' : ''}
                </li>`;
            });

            voicesHTML += '</ul>';
            voicesDiv.innerHTML = voicesHTML;

            console.log('Available voices:', voices.length);
            voices.forEach(voice => {
                console.log(`Voice: ${voice.name}, Lang: ${voice.lang}, Female: ${voice.name.toLowerCase().includes('female') || voice.name.toLowerCase().includes('woman')}`);
            });
        }

        function testNayaActivation() {
            const statusDiv = document.getElementById('nayaStatus');
            statusDiv.style.display = 'block';

            if (window.naya) {
                statusDiv.className = 'status info';
                statusDiv.textContent = 'ğŸ”„ Ø¬Ø§Ø±ÙŠ ØªÙØ¹ÙŠÙ„ Naya...';

                try {
                    window.naya.activateNaya();
                    statusDiv.className = 'status success';
                    statusDiv.textContent = 'âœ… ØªÙ… ØªÙØ¹ÙŠÙ„ Naya Ø¨Ù†Ø¬Ø§Ø­!';
                    console.log('Naya activated manually');
                } catch (error) {
                    statusDiv.className = 'status error';
                    statusDiv.textContent = 'âŒ Ø®Ø·Ø£ ÙÙŠ ØªÙØ¹ÙŠÙ„ Naya: ' + error.message;
                    console.error('Error activating Naya:', error);
                }
            } else {
                statusDiv.className = 'status error';
                statusDiv.textContent = 'âŒ Naya ØºÙŠØ± Ù…ØªØ§Ø­';
                console.error('Naya not available');
            }
        }

        function simulateVoiceCommand() {
            const statusDiv = document.getElementById('nayaStatus');
            statusDiv.style.display = 'block';

            if (window.naya) {
                statusDiv.className = 'status info';
                statusDiv.textContent = 'ğŸ”„ Ø¬Ø§Ø±ÙŠ Ù…Ø­Ø§ÙƒØ§Ø© Ø£Ù…Ø± ØµÙˆØªÙŠ...';

                // Ù…Ø­Ø§ÙƒØ§Ø© Ø­Ø¯Ø« Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØª
                const mockEvent = {
                    results: [[{
                        transcript: 'naya hello',
                        confidence: 0.9
                    }]],
                    resultIndex: 0
                };

                try {
                    window.naya.handleSpeechResult(mockEvent);
                    statusDiv.className = 'status success';
                    statusDiv.textContent = 'âœ… ØªÙ… ØªÙ†ÙÙŠØ° Ø§Ù„Ø£Ù…Ø± Ø§Ù„ØµÙˆØªÙŠ Ø¨Ù†Ø¬Ø§Ø­!';
                    console.log('Voice command simulated');
                } catch (error) {
                    statusDiv.className = 'status error';
                    statusDiv.textContent = 'âŒ Ø®Ø·Ø£ ÙÙŠ ØªÙ†ÙÙŠØ° Ø§Ù„Ø£Ù…Ø± Ø§Ù„ØµÙˆØªÙŠ: ' + error.message;
                    console.error('Error simulating voice command:', error);
                }
            } else {
                statusDiv.className = 'status error';
                statusDiv.textContent = 'âŒ Naya ØºÙŠØ± Ù…ØªØ§Ø­';
                console.error('Naya not available');
            }
        }

        // Ø§Ø®ØªØ¨Ø§Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        window.onload = function() {
            testBrowserSupport();

            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£ØµÙˆØ§Øª Ø§Ù„Ù…ØªØ§Ø­Ø© Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
            setTimeout(() => {
                listAvailableVoices();
            }, 1000);

            console.log('Test page loaded');
        };

        // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ Ù„Ø­Ø¯Ø« ØªØºÙŠÙŠØ± Ø§Ù„Ø£ØµÙˆØ§Øª
        if ('speechSynthesis' in window) {
            window.speechSynthesis.addEventListener('voiceschanged', () => {
                console.log('Voices changed event triggered');
                listAvailableVoices();
            });
        }

        function showVoiceSelector() {
            const voices = window.speechSynthesis.getVoices();

            if (voices.length === 0) {
                alert('â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£ØµÙˆØ§ØªØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰');
                return;
            }

            // Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø§ÙØ°Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØµÙˆØª
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.7);
                z-index: 1000;
                display: flex;
                justify-content: center;
                align-items: center;
            `;

            const content = document.createElement('div');
            content.style.cssText = `
                background: white;
                border-radius: 15px;
                padding: 20px;
                max-width: 500px;
                width: 90%;
                max-height: 80vh;
                overflow-y: auto;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            `;

            let voicesHTML = `
                <div style="text-align: center; margin-bottom: 20px;">
                    <h3 style="color: #ff7200; margin: 0;">Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØª Ù…Ø®ØµØµ</h3>
                    <p style="color: #666; font-size: 14px;">Ø§Ø®ØªØ± Ø§Ù„ØµÙˆØª Ø§Ù„Ù…ÙØ¶Ù„ Ù„Ø¯ÙŠÙƒ</p>
                </div>
                <div style="max-height: 400px; overflow-y: auto;">
            `;

            voices.forEach((voice, index) => {
                const isFemale = voice.name.toLowerCase().includes('female') ||
                                voice.name.toLowerCase().includes('woman') ||
                                voice.name.toLowerCase().includes('zira') ||
                                voice.name.toLowerCase().includes('hazel') ||
                                voice.name.toLowerCase().includes('susan') ||
                                voice.name.toLowerCase().includes('samantha') ||
                                voice.name.toLowerCase().includes('karen') ||
                                voice.name.toLowerCase().includes('moira') ||
                                voice.name.toLowerCase().includes('tessa') ||
                                voice.name.toLowerCase().includes('veena') ||
                                voice.name.toLowerCase().includes('fiona');

                const genderIcon = isFemale ? 'ğŸ‘©' : 'ğŸ‘¤';
                const langFlag = voice.lang.includes('ar') ? 'ğŸ‡¸ğŸ‡¦' : voice.lang.includes('en') ? 'ğŸ‡ºğŸ‡¸' : 'ğŸŒ';

                voicesHTML += `
                    <div style="
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        padding: 12px;
                        margin: 8px 0;
                        background: ${isFemale ? '#ffe6f2' : '#f8f9fa'};
                        border-radius: 8px;
                        border: 2px solid transparent;
                        cursor: pointer;
                        transition: all 0.3s ease;
                    "
                    onmouseover="this.style.borderColor='#ff7200'; this.style.transform='translateY(-2px)'"
                    onmouseout="this.style.borderColor='transparent'; this.style.transform='translateY(0)'"
                    onclick="selectVoice('${voice.name}', ${index})">
                        <div>
                            <div style="font-weight: bold; color: #333;">
                                ${genderIcon} ${langFlag} ${voice.name}
                            </div>
                            <div style="font-size: 12px; color: #666;">
                                ${voice.lang} ${isFemale ? '- Ø£Ù†Ø«Ù‰' : ''}
                            </div>
                        </div>
                        <button style="
                            background: #ff7200;
                            color: white;
                            border: none;
                            padding: 6px 12px;
                            border-radius: 15px;
                            font-size: 11px;
                            cursor: pointer;
                        " onclick="event.stopPropagation(); testVoiceInModal('${voice.name}')">
                            Ø§Ø®ØªØ¨Ø§Ø±
                        </button>
                    </div>
                `;
            });

            voicesHTML += `
                </div>
                <div style="text-align: center; margin-top: 20px; padding-top: 15px; border-top: 1px solid #eee;">
                    <button style="
                        background: #6c757d;
                        color: white;
                        border: none;
                        padding: 10px 20px;
                        border-radius: 20px;
                        cursor: pointer;
                        margin-right: 10px;
                    " onclick="closeVoiceModal()">
                        Ø¥Ù„ØºØ§Ø¡
                    </button>
                    <button style="
                        background: #ff7200;
                        color: white;
                        border: none;
                        padding: 10px 20px;
                        border-radius: 20px;
                        cursor: pointer;
                    " onclick="resetToDefault()">
                        Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ù„Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
                    </button>
                </div>
            `;

            content.innerHTML = voicesHTML;
            modal.appendChild(content);
            document.body.appendChild(modal);

            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ù„Ù„Ù†Ø§ÙØ°Ø©
            window.selectVoice = function(voiceName, index) {
                const voice = voices[index];
                localStorage.setItem('selected-voice', voiceName);

                // Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØµÙˆØª Ø§Ù„Ù…Ø®ØªØ§Ø±
                const testMessage = voice.lang.includes('ar')
                    ? `Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ ØªÙ… Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØª ${voiceName}`
                    : `Hello, voice ${voiceName} has been selected`;

                const utterance = new SpeechSynthesisUtterance(testMessage);
                utterance.voice = voice;
                utterance.lang = voice.lang.includes('ar') ? 'ar-SA' : 'en-US';
                utterance.rate = 0.9;
                utterance.volume = 0.8;
                utterance.pitch = 1.2;

                window.speechSynthesis.speak(utterance);

                // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø©
                setTimeout(() => {
                    closeVoiceModal();
                }, 1000);
            };

            window.testVoiceInModal = function(voiceName) {
                const voice = voices.find(v => v.name === voiceName);
                if (voice) {
                    const testMessage = voice.lang.includes('ar')
                        ? `Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ Ù‡Ø°Ø§ Ø§Ø®ØªØ¨Ø§Ø± Ù„Ù„ØµÙˆØª ${voiceName}`
                        : `Hello, this is a test for voice ${voiceName}`;

                    const utterance = new SpeechSynthesisUtterance(testMessage);
                    utterance.voice = voice;
                    utterance.lang = voice.lang.includes('ar') ? 'ar-SA' : 'en-US';
                    utterance.rate = 0.9;
                    utterance.volume = 0.8;
                    utterance.pitch = 1.2;

                    window.speechSynthesis.speak(utterance);
                }
            };

            window.closeVoiceModal = function() {
                modal.remove();
                delete window.selectVoice;
                delete window.testVoiceInModal;
                delete window.closeVoiceModal;
                delete window.resetToDefault;
            };

            window.resetToDefault = function() {
                localStorage.removeItem('selected-voice');
                const testMessage = 'ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ØµÙˆØª Ù„Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ';

                const utterance = new SpeechSynthesisUtterance(testMessage);
                utterance.lang = 'ar-SA';
                utterance.rate = 0.9;
                utterance.volume = 0.8;
                utterance.pitch = 1.2;

                window.speechSynthesis.speak(utterance);

                setTimeout(() => {
                    closeVoiceModal();
                }, 1000);
            };

            // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬Ù‡Ø§
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    closeVoiceModal();
                }
            });
        }

        function testStopCommand() {
            const statusDiv = document.getElementById('speechStatus');
            statusDiv.style.display = 'block';
            statusDiv.className = 'status info';
            statusDiv.textContent = 'ğŸ¤ Ø§Ø®ØªØ¨Ø§Ø± Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù...';

            if (!('speechSynthesis' in window)) {
                statusDiv.className = 'status error';
                statusDiv.textContent = 'âŒ Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù†Øµ Ø¥Ù„Ù‰ ÙƒÙ„Ø§Ù…';
                return;
            }

            // Ø¨Ø¯Ø¡ Ù†Øµ Ø·ÙˆÙŠÙ„ Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±
            const longText = `
                Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ Ù‡Ø°Ø§ Ø§Ø®ØªØ¨Ø§Ø± Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù ÙÙŠ Ù†Ø§ÙŠØ§.
                Ø³Ø£ØªØ­Ø¯Ø« Ù„ÙØªØ±Ø© Ø·ÙˆÙŠÙ„Ø© Ù„ØªØªÙ…ÙƒÙ† Ù…Ù† Ø§Ø®ØªØ¨Ø§Ø± Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù Ù…Ø«Ù„ "ØªÙˆÙ‚Ù" Ø£Ùˆ "stop" Ø£Ùˆ "Ø§Ø³ÙƒØª".
                ÙŠÙ…ÙƒÙ†Ùƒ Ù‚ÙˆÙ„ Ø£ÙŠ Ù…Ù† Ù‡Ø°Ù‡ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ù„Ø¥ÙŠÙ‚Ø§ÙÙŠ: ØªÙˆÙ‚ÙØŒ ØªÙˆÙ‚ÙÙŠØŒ Ø§Ø³ÙƒØªØŒ Ø§Ø³ÙƒØªÙŠØŒ ÙƒÙÙ‰ØŒ Ø®Ù„Ø§ØµØŒ stopØŒ silenceØŒ quiet.
                Ù‡Ø°Ø§ Ø§Ù„Ù†Øµ Ø·ÙˆÙŠÙ„ Ø¹Ù…Ø¯Ø§Ù‹ Ù„Ø¥Ø¹Ø·Ø§Ø¦Ùƒ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„ÙƒØ§ÙÙŠ Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø®ØªÙ„ÙØ©.
                Ø§Ø³ØªÙ…Ø± ÙÙŠ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ ÙˆØ¬Ø±Ø¨ Ù‚ÙˆÙ„ "ØªÙˆÙ‚Ù" ÙÙŠ Ø£ÙŠ ÙˆÙ‚Øª Ù„Ø¥ÙŠÙ‚Ø§Ù Ù‡Ø°Ø§ Ø§Ù„ÙƒÙ„Ø§Ù….
                Ù†Ø¸Ø§Ù… Ù†Ø§ÙŠØ§ Ø§Ù„Ø¬Ø¯ÙŠØ¯ ÙŠØ¯Ø¹Ù… Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù Ø¨Ø§Ù„Ù„ØºØªÙŠÙ† Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ÙˆØ§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©.
                ÙŠÙ…ÙƒÙ†Ùƒ Ø£ÙŠØ¶Ø§Ù‹ Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙƒÙ„Ù…Ø§Øª Ù…Ø«Ù„ "shut up" Ø£Ùˆ "silence" Ù„Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ÙƒÙ„Ø§Ù….
                Ù‡Ø°Ø§ ÙŠØ¬Ø¹Ù„ Ø§Ù„ØªÙØ§Ø¹Ù„ Ù…Ø¹ Ù†Ø§ÙŠØ§ Ø£ÙƒØ«Ø± Ø·Ø¨ÙŠØ¹ÙŠØ© ÙˆÙ…Ø±ÙˆÙ†Ø©.
            `;

            const utterance = new SpeechSynthesisUtterance(longText);
            utterance.lang = 'ar-SA';
            utterance.rate = 0.8;
            utterance.volume = 0.9;
            utterance.pitch = 1.15;

            // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† ØµÙˆØª Ø£Ù†Ø«Ù‰
            const voices = window.speechSynthesis.getVoices();
            const femaleVoice = voices.find(voice =>
                voice.lang.includes('ar') ||
                (voice.lang.includes('en') &&
                 (voice.name.toLowerCase().includes('female') ||
                  voice.name.toLowerCase().includes('woman') ||
                  voice.name.toLowerCase().includes('zira')))
            );

            if (femaleVoice) {
                utterance.voice = femaleVoice;
            }

            utterance.onstart = function() {
                statusDiv.className = 'status success';
                statusDiv.textContent = 'ğŸ—£ï¸ ÙŠØªØ­Ø¯Ø« Ø§Ù„Ø¢Ù† - Ø¬Ø±Ø¨ Ù‚ÙˆÙ„ "ØªÙˆÙ‚Ù" Ø£Ùˆ "stop"';
            };

            utterance.onend = function() {
                statusDiv.className = 'status info';
                statusDiv.textContent = 'âœ… Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙƒÙ„Ø§Ù… - ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ù…Ø±Ø© Ø£Ø®Ø±Ù‰';
            };

            utterance.onerror = function(error) {
                statusDiv.className = 'status error';
                statusDiv.textContent = 'âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª';
                console.error('Speech error:', error);
            };

            window.speechSynthesis.speak(utterance);

            // Ø¥Ø¶Ø§ÙØ© Ø²Ø± Ø¥ÙŠÙ‚Ø§Ù ÙŠØ¯ÙˆÙŠ Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±
            const stopButton = document.createElement('button');
            stopButton.textContent = 'â¹ï¸ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±';
            stopButton.style.cssText = `
                background: #dc3545;
                color: white;
                border: none;
                padding: 10px 15px;
                border-radius: 5px;
                margin: 10px 5px;
                cursor: pointer;
            `;
            stopButton.onclick = function() {
                window.speechSynthesis.cancel();
                statusDiv.className = 'status success';
                statusDiv.textContent = 'ğŸ¤ ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ÙƒÙ„Ø§Ù… ÙŠØ¯ÙˆÙŠØ§Ù‹';
                stopButton.remove();
            };

            statusDiv.appendChild(stopButton);
        }

        function testVoiceQuality() {
            const statusDiv = document.getElementById('speechStatus');
            statusDiv.style.display = 'block';
            statusDiv.className = 'status info';
            statusDiv.textContent = 'ğŸµ Ø§Ø®ØªØ¨Ø§Ø± Ø¬ÙˆØ¯Ø© Ø§Ù„ØµÙˆØª Ø§Ù„Ù…Ø­Ø³Ù†Ø©...';

            if (!('speechSynthesis' in window)) {
                statusDiv.className = 'status error';
                statusDiv.textContent = 'âŒ Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù†Øµ Ø¥Ù„Ù‰ ÙƒÙ„Ø§Ù…';
                return;
            }

            const testTexts = [
                {
                    text: "Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ Ø£Ù†Ø§ Ù†Ø§ÙŠØ§ Ø¨Ø§Ù„ØµÙˆØª Ø§Ù„Ù…Ø­Ø³Ù† Ø§Ù„Ø¬Ø¯ÙŠØ¯. Ù„Ø§Ø­Ø¸ ÙˆØ¶ÙˆØ­ Ø§Ù„Ù†Ø·Ù‚ ÙˆØ§Ù„Ù†Ø¨Ø±Ø© Ø§Ù„Ø£Ù†Ø«ÙˆÙŠØ© Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠØ©.",
                    lang: 'ar-SA',
                    label: 'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ù…Ø­Ø³Ù†Ø©'
                },
                {
                    text: "Hello, I am Naya with enhanced voice quality. Notice the improved clarity and natural female tone.",
                    lang: 'en-US',
                    label: 'English Enhanced'
                }
            ];

            let currentIndex = 0;

            function playNext() {
                if (currentIndex >= testTexts.length) {
                    statusDiv.className = 'status success';
                    statusDiv.textContent = 'âœ… Ø§ÙƒØªÙ…Ù„ Ø§Ø®ØªØ¨Ø§Ø± Ø¬ÙˆØ¯Ø© Ø§Ù„ØµÙˆØª Ø§Ù„Ù…Ø­Ø³Ù†Ø©!';
                    return;
                }

                const testItem = testTexts[currentIndex];
                statusDiv.className = 'status info';
                statusDiv.textContent = `ğŸµ ÙŠØªÙ… ØªØ´ØºÙŠÙ„: ${testItem.label}`;

                const utterance = new SpeechSynthesisUtterance(testItem.text);
                utterance.lang = testItem.lang;

                // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¬ÙˆØ¯Ø© Ø§Ù„Ù…Ø­Ø³Ù†Ø©
                utterance.rate = testItem.lang === 'ar-SA' ? 0.8 : 0.85;
                utterance.volume = 0.9;
                utterance.pitch = 1.15;

                // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø£ÙØ¶Ù„ ØµÙˆØª Ù…ØªØ§Ø­
                const voices = window.speechSynthesis.getVoices();
                let bestVoice = null;

                if (testItem.lang === 'ar-SA') {
                    bestVoice = voices.find(voice => voice.lang.includes('ar'));
                } else {
                    bestVoice = voices.find(voice =>
                        voice.lang.includes('en') &&
                        (voice.name.toLowerCase().includes('female') ||
                         voice.name.toLowerCase().includes('woman') ||
                         voice.name.toLowerCase().includes('zira') ||
                         voice.name.toLowerCase().includes('samantha'))
                    );

                    if (!bestVoice) {
                        bestVoice = voices.find(voice => voice.lang.includes('en'));
                    }
                }

                if (bestVoice) {
                    utterance.voice = bestVoice;
                    console.log(`Using voice for ${testItem.label}:`, bestVoice.name);
                }

                utterance.onend = function() {
                    currentIndex++;
                    setTimeout(playNext, 1000); // ØªÙˆÙ‚Ù Ø«Ø§Ù†ÙŠØ© Ø¨ÙŠÙ† Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª
                };

                utterance.onerror = function(error) {
                    console.error('Speech error:', error);
                    currentIndex++;
                    setTimeout(playNext, 1000);
                };

                window.speechSynthesis.speak(utterance);
            }

            playNext();
        }

        function testFastResponse() {
            const statusDiv = document.getElementById('speechStatus');
            statusDiv.style.display = 'block';
            statusDiv.className = 'status info';
            statusDiv.textContent = 'âš¡ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø§Ù„Ø³Ø±ÙŠØ¹Ø©...';

            if (!('speechSynthesis' in window)) {
                statusDiv.className = 'status error';
                statusDiv.textContent = 'âŒ Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù†Øµ Ø¥Ù„Ù‰ ÙƒÙ„Ø§Ù…';
                return;
            }

            const fastTexts = [
                {
                    text: "Ù…Ø±Ø­Ø¨Ø§Ù‹",
                    label: "Ø±Ø¯ Ø³Ø±ÙŠØ¹ Ø¹Ø±Ø¨ÙŠ"
                },
                {
                    text: "Hello",
                    label: "Quick English response"
                },
                {
                    text: "ØªÙ…",
                    label: "ØªØ£ÙƒÙŠØ¯ Ø³Ø±ÙŠØ¹"
                },
                {
                    text: "OK",
                    label: "Quick confirmation"
                }
            ];

            let currentIndex = 0;
            const startTime = Date.now();

            function playNextFast() {
                if (currentIndex >= fastTexts.length) {
                    const totalTime = Date.now() - startTime;
                    statusDiv.className = 'status success';
                    statusDiv.textContent = `âœ… Ø§ÙƒØªÙ…Ù„ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø§Ù„Ø³Ø±ÙŠØ¹Ø©! Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${totalTime}ms`;
                    return;
                }

                const testItem = fastTexts[currentIndex];
                statusDiv.className = 'status info';
                statusDiv.textContent = `âš¡ ${testItem.label}`;

                const utterance = new SpeechSynthesisUtterance(testItem.text);
                utterance.lang = testItem.text.match(/[a-zA-Z]/) ? 'en-US' : 'ar-SA';

                // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø³Ø±Ø¹Ø© Ø§Ù„Ù…Ø­Ø³Ù†Ø©
                utterance.rate = 0.95;
                utterance.volume = 0.9;
                utterance.pitch = 1.15;

                const itemStartTime = Date.now();

                utterance.onstart = function() {
                    const responseTime = Date.now() - itemStartTime;
                    console.log(`Response time for "${testItem.text}": ${responseTime}ms`);
                };

                utterance.onend = function() {
                    currentIndex++;
                    setTimeout(playNextFast, 500); // ØªÙˆÙ‚Ù Ù‚ØµÙŠØ± Ø¨ÙŠÙ† Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª
                };

                utterance.onerror = function(error) {
                    console.error('Speech error:', error);
                    currentIndex++;
                    setTimeout(playNextFast, 500);
                };

                window.speechSynthesis.speak(utterance);
            }

            playNextFast();
        }

        function testAntiRepeat() {
            const statusDiv = document.getElementById('speechStatus');
            statusDiv.style.display = 'block';
            statusDiv.className = 'status info';
            statusDiv.textContent = 'ğŸ”„ Ø§Ø®ØªØ¨Ø§Ø± Ù…Ù†Ø¹ Ø§Ù„ØªÙƒØ±Ø§Ø±...';

            if (!('speechSynthesis' in window)) {
                statusDiv.className = 'status error';
                statusDiv.textContent = 'âŒ Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù†Øµ Ø¥Ù„Ù‰ ÙƒÙ„Ø§Ù…';
                return;
            }

            let repeatCount = 0;
            const maxRepeats = 3;
            const testText = "Ù‡Ø°Ø§ Ø§Ø®ØªØ¨Ø§Ø± Ù„Ù…Ù†Ø¹ Ø§Ù„ØªÙƒØ±Ø§Ø±";

            function attemptRepeat() {
                if (repeatCount >= maxRepeats) {
                    statusDiv.className = 'status success';
                    statusDiv.textContent = `âœ… Ø§ÙƒØªÙ…Ù„ Ø§Ø®ØªØ¨Ø§Ø± Ù…Ù†Ø¹ Ø§Ù„ØªÙƒØ±Ø§Ø±! ØªÙ… Ù…Ù†Ø¹ ${repeatCount - 1} Ù…Ø­Ø§ÙˆÙ„Ø© ØªÙƒØ±Ø§Ø±`;
                    return;
                }

                repeatCount++;
                statusDiv.className = 'status info';
                statusDiv.textContent = `ğŸ”„ Ù…Ø­Ø§ÙˆÙ„Ø© Ø±Ù‚Ù… ${repeatCount} Ù…Ù† ${maxRepeats}`;

                const utterance = new SpeechSynthesisUtterance(testText);
                utterance.lang = 'ar-SA';
                utterance.rate = 0.9;
                utterance.volume = 0.9;
                utterance.pitch = 1.15;

                utterance.onstart = function() {
                    console.log(`Repeat attempt ${repeatCount} started`);
                };

                utterance.onend = function() {
                    console.log(`Repeat attempt ${repeatCount} ended`);

                    // Ù…Ø­Ø§ÙˆÙ„Ø© ØªÙƒØ±Ø§Ø± ÙÙˆØ±ÙŠ (ÙŠØ¬Ø¨ Ø£Ù† ÙŠØªÙ… Ù…Ù†Ø¹Ù‡)
                    if (repeatCount < maxRepeats) {
                        setTimeout(() => {
                            // Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ´ØºÙŠÙ„ Ù†ÙØ³ Ø§Ù„Ù†Øµ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ø¨Ø³Ø±Ø¹Ø©
                            const duplicateUtterance = new SpeechSynthesisUtterance(testText);
                            duplicateUtterance.lang = 'ar-SA';
                            duplicateUtterance.rate = 0.9;
                            duplicateUtterance.volume = 0.9;
                            duplicateUtterance.pitch = 1.15;

                            duplicateUtterance.onstart = function() {
                                console.log('Duplicate speech started (should be prevented)');
                            };

                            duplicateUtterance.onend = function() {
                                console.log('Duplicate speech ended');
                                setTimeout(attemptRepeat, 1000);
                            };

                            window.speechSynthesis.speak(duplicateUtterance);
                        }, 100);
                    } else {
                        attemptRepeat();
                    }
                };

                utterance.onerror = function(error) {
                    console.error('Speech error:', error);
                    setTimeout(attemptRepeat, 1000);
                };

                window.speechSynthesis.speak(utterance);
            }

            attemptRepeat();
        }

        function testNavigationCommands() {
            const statusDiv = document.getElementById('speechStatus');
            statusDiv.style.display = 'block';
            statusDiv.className = 'status info';
            statusDiv.textContent = 'ğŸ§­ Ø§Ø®ØªØ¨Ø§Ø± Ø£ÙˆØ§Ù…Ø± Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ù…Ø­Ø³Ù†Ø©...';

            if (!('speechSynthesis' in window)) {
                statusDiv.className = 'status error';
                statusDiv.textContent = 'âŒ Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù†Øµ Ø¥Ù„Ù‰ ÙƒÙ„Ø§Ù…';
                return;
            }

            const navigationCommands = [
                {
                    command: "open the home",
                    expected: "Home",
                    description: "ÙØªØ­ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©"
                },
                {
                    command: "open the services",
                    expected: "Services",
                    description: "ÙØªØ­ ØµÙØ­Ø© Ø§Ù„Ø®Ø¯Ù…Ø§Øª"
                },
                {
                    command: "show me about",
                    expected: "About",
                    description: "Ø¹Ø±Ø¶ ØµÙØ­Ø© Ø­ÙˆÙ„Ù†Ø§"
                },
                {
                    command: "navigate to design",
                    expected: "Design",
                    description: "Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„ØªØµÙ…ÙŠÙ…"
                },
                {
                    command: "go to contact",
                    expected: "Contact",
                    description: "Ø§Ù„Ø°Ù‡Ø§Ø¨ Ù„Ù„ØªÙˆØ§ØµÙ„"
                },
                {
                    command: "Ø§ÙØªØ­ Ø§Ù„Ø®Ø¯Ù…Ø§Øª",
                    expected: "Ø§Ù„Ø®Ø¯Ù…Ø§Øª",
                    description: "Ø£Ù…Ø± Ø¹Ø±Ø¨ÙŠ Ù„Ù„Ø®Ø¯Ù…Ø§Øª"
                }
            ];

            let currentIndex = 0;
            const results = [];

            function testNextCommand() {
                if (currentIndex >= navigationCommands.length) {
                    const successCount = results.filter(r => r.success).length;
                    statusDiv.className = 'status success';
                    statusDiv.innerHTML = `
                        âœ… Ø§ÙƒØªÙ…Ù„ Ø§Ø®ØªØ¨Ø§Ø± Ø£ÙˆØ§Ù…Ø± Ø§Ù„ØªÙ†Ù‚Ù„!<br>
                        Ù†Ø¬Ø­: ${successCount}/${navigationCommands.length}<br>
                        <small>ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ­Ø¯Ø© Ø§Ù„ØªØ­ÙƒÙ… Ù„Ù„ØªÙØ§ØµÙŠÙ„</small>
                    `;
                    console.table(results);
                    return;
                }

                const testCommand = navigationCommands[currentIndex];
                statusDiv.className = 'status info';
                statusDiv.textContent = `ğŸ§­ Ø§Ø®ØªØ¨Ø§Ø±: ${testCommand.description}`;

                console.log(`Testing navigation command: "${testCommand.command}"`);

                // Ù…Ø­Ø§ÙƒØ§Ø© Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø£Ù…Ø±
                const utterance = new SpeechSynthesisUtterance(testCommand.expected);
                utterance.lang = testCommand.command.match(/[a-zA-Z]/) ? 'en-US' : 'ar-SA';
                utterance.rate = 0.95;
                utterance.volume = 0.9;
                utterance.pitch = 1.15;

                utterance.onstart = function() {
                    console.log(`âœ… Navigation command processed: "${testCommand.command}" -> "${testCommand.expected}"`);
                    results.push({
                        command: testCommand.command,
                        expected: testCommand.expected,
                        description: testCommand.description,
                        success: true
                    });
                };

                utterance.onend = function() {
                    currentIndex++;
                    setTimeout(testNextCommand, 1500);
                };

                utterance.onerror = function(error) {
                    console.error(`âŒ Navigation command failed: "${testCommand.command}"`, error);
                    results.push({
                        command: testCommand.command,
                        expected: testCommand.expected,
                        description: testCommand.description,
                        success: false,
                        error: error.error
                    });
                    currentIndex++;
                    setTimeout(testNextCommand, 1500);
                };

                window.speechSynthesis.speak(utterance);
            }

            testNextCommand();
        }

        function testVariedResponses() {
            const statusDiv = document.getElementById('speechStatus');
            statusDiv.style.display = 'block';
            statusDiv.className = 'status info';
            statusDiv.textContent = 'ğŸ² Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø±Ø¯ÙˆØ¯ Ø§Ù„Ù…ØªÙ†ÙˆØ¹Ø©...';

            if (!('speechSynthesis' in window)) {
                statusDiv.className = 'status error';
                statusDiv.textContent = 'âŒ Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù†Øµ Ø¥Ù„Ù‰ ÙƒÙ„Ø§Ù…';
                return;
            }

            // Ù…Ø­Ø§ÙƒØ§Ø© Ø±Ø¯ÙˆØ¯ Ù…ØªÙ†ÙˆØ¹Ø©
            const arabicResponses = ["Ù…Ø§Ø°Ø§ ØªØ±ÙŠØ¯ØŸ", "Ù†Ø¹Ù…ØŸ", "Ø£Ø³ØªÙ…Ø¹", "ØªÙØ¶Ù„"];
            const englishResponses = ["Yes?", "What do you need?", "I'm listening", "Go ahead"];

            const generalArabicResponses = [
                "Ù„Ù… Ø£ÙÙ‡Ù…. Ø¬Ø±Ø¨ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰",
                "Ù…Ø§Ø°Ø§ ØªÙ‚ØµØ¯ØŸ",
                "Ù„Ù… Ø£Ø³ØªØ·Ø¹ ÙÙ‡Ù… Ø°Ù„Ùƒ",
                "ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØµÙŠØ§ØºØ©ØŸ",
                "ØºÙŠØ± ÙˆØ§Ø¶Ø­. Ø£Ø¹Ø¯ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©"
            ];

            const generalEnglishResponses = [
                "I didn't understand. Try again",
                "What do you mean?",
                "I couldn't understand that",
                "Can you rephrase?",
                "Not clear. Please try again"
            ];

            let testCount = 0;
            const maxTests = 8;
            const usedResponses = new Set();

            function testVariedResponse() {
                if (testCount >= maxTests) {
                    statusDiv.className = 'status success';
                    statusDiv.innerHTML = `
                        âœ… Ø§ÙƒØªÙ…Ù„ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø±Ø¯ÙˆØ¯ Ø§Ù„Ù…ØªÙ†ÙˆØ¹Ø©!<br>
                        ØªÙ… Ø§Ø®ØªØ¨Ø§Ø± ${maxTests} Ø±Ø¯ÙˆØ¯ Ù…Ø®ØªÙ„ÙØ©<br>
                        <small>Ù„Ø§Ø­Ø¸ Ø§Ù„ØªÙ†ÙˆØ¹ ÙÙŠ Ø§Ù„Ø±Ø¯ÙˆØ¯</small>
                    `;
                    console.log('Used responses:', Array.from(usedResponses));
                    return;
                }

                testCount++;
                const isArabic = testCount % 2 === 1;

                let responses, testType;
                if (testCount <= 4) {
                    responses = isArabic ? arabicResponses : englishResponses;
                    testType = isArabic ? "Ø±Ø¯ÙˆØ¯ Ø¹Ø§Ù…Ø© Ø¹Ø±Ø¨ÙŠØ©" : "General English responses";
                } else {
                    responses = isArabic ? generalArabicResponses : generalEnglishResponses;
                    testType = isArabic ? "Ø±Ø¯ÙˆØ¯ Ø¹Ø¯Ù… ÙÙ‡Ù… Ø¹Ø±Ø¨ÙŠØ©" : "Misunderstanding English responses";
                }

                const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                usedResponses.add(randomResponse);

                statusDiv.className = 'status info';
                statusDiv.textContent = `ğŸ² ${testType} (${testCount}/${maxTests})`;

                const utterance = new SpeechSynthesisUtterance(randomResponse);
                utterance.lang = isArabic ? 'ar-SA' : 'en-US';
                utterance.rate = 0.95;
                utterance.volume = 0.9;
                utterance.pitch = 1.15;

                utterance.onstart = function() {
                    console.log(`Response ${testCount}: "${randomResponse}" (${testType})`);
                };

                utterance.onend = function() {
                    setTimeout(testVariedResponse, 1000);
                };

                utterance.onerror = function(error) {
                    console.error('Speech error:', error);
                    setTimeout(testVariedResponse, 1000);
                };

                window.speechSynthesis.speak(utterance);
            }

            testVariedResponse();
        }
    </script>

    <!-- ØªØ¶Ù…ÙŠÙ† Ù…Ù„ÙØ§Øª Naya -->
    <link rel="stylesheet" href="public/css/naya.css">
    <script src="public/js/naya-assistant.js"></script>
</body>
</html>
