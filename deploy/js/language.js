/* ===== ENERGY.AI LANGUAGE SYSTEM ===== */

class LanguageManager {
    constructor() {
        this.currentLanguage = 'ar';
        this.supportedLanguages = ['ar', 'en'];
        this.translations = {};
        this.init();
    }

    init() {
        this.loadTranslations();
        this.detectLanguage();
        this.setupLanguageToggle();
        console.log('üåê Language Manager initialized');
    }

    loadTranslations() {
        this.translations = {
            ar: {
                // Navigation
                'HOME': 'ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©',
                'ABOUT': 'ÿ≠ŸàŸÑŸÜÿß',
                'SERVICE': 'ÿßŸÑÿÆÿØŸÖÿßÿ™',
                'DESIGN': 'ÿßŸÑÿ™ÿµŸÖŸäŸÖ',
                'CONTACT': 'ÿßÿ™ÿµŸÑ ÿ®ŸÜÿß',
                
                // Main content
                'Web Design & Development Energy': 'ÿ™ÿµŸÖŸäŸÖ Ÿàÿ™ÿ∑ŸàŸäÿ± ÿßŸÑŸàŸäÿ® ŸÑŸÑÿ∑ÿßŸÇÿ©',
                'AI is the spark igniting a new era of energy innovation': 'ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä ŸáŸà ÿßŸÑÿ¥ÿ±ÿßÿ±ÿ© ÿßŸÑÿ™Ÿä ÿ™ÿ¥ÿπŸÑ ÿπÿµÿ±ÿßŸã ÿ¨ÿØŸäÿØÿßŸã ŸÖŸÜ ÿßŸÑÿßÿ®ÿ™ŸÉÿßÿ± ŸÅŸä ÿßŸÑÿ∑ÿßŸÇÿ©',
                'powering tomorrow with intelligent solutions today': 'ŸÜÿ¥ÿ∫ŸÑ ÿßŸÑÿ∫ÿØ ÿ®ÿ≠ŸÑŸàŸÑ ÿ∞ŸÉŸäÿ© ÿßŸÑŸäŸàŸÖ',
                'Join Us': 'ÿßŸÜÿ∂ŸÖ ÿ•ŸÑŸäŸÜÿß',
                
                // About section
                'About Energy.AI': 'ÿ≠ŸàŸÑ Energy.AI',
                'Energy.AI is at the forefront of combining artificial intelligence with energy solutions': 'Energy.AI ŸÅŸä ÿßŸÑŸÖŸÇÿØŸÖÿ© ŸÑÿØŸÖÿ¨ ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä ŸÖÿπ ÿ≠ŸÑŸàŸÑ ÿßŸÑÿ∑ÿßŸÇÿ©',
                'Smart Energy Management': 'ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ∑ÿßŸÇÿ© ÿßŸÑÿ∞ŸÉŸäÿ©',
                'Sustainable Solutions': 'ÿ≠ŸÑŸàŸÑ ŸÖÿ≥ÿ™ÿØÿßŸÖÿ©',
                'Data-Driven Insights': 'ÿ±ÿ§Ÿâ ŸÖÿØŸÅŸàÿπÿ© ÿ®ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™',
                
                // Services
                'Our Services': 'ÿÆÿØŸÖÿßÿ™ŸÜÿß',
                'Energy Optimization': 'ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑÿ∑ÿßŸÇÿ©',
                'Predictive Maintenance': 'ÿßŸÑÿµŸäÿßŸÜÿ© ÿßŸÑÿ™ŸÜÿ®ÿ§Ÿäÿ©',
                'Energy Security': 'ÿ£ŸÖÿßŸÜ ÿßŸÑÿ∑ÿßŸÇÿ©',
                'Cloud Energy Management': 'ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ∑ÿßŸÇÿ© ÿßŸÑÿ≥ÿ≠ÿßÿ®Ÿäÿ©',
                
                // Design
                'Our Design Approach': 'ŸÜŸáÿ¨ ÿßŸÑÿ™ÿµŸÖŸäŸÖ ŸÑÿØŸäŸÜÿß',
                'Energy.map': 'ÿÆÿ±Ÿäÿ∑ÿ© ÿßŸÑÿ∑ÿßŸÇÿ©',
                'Professional Geospatial Intelligence': 'ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿ¨ÿ∫ÿ±ÿßŸÅŸä ÿßŸÑŸÖŸÉÿßŸÜŸä ÿßŸÑŸÖŸáŸÜŸä',
                
                // Contact
                'Contact Us': 'ÿßÿ™ÿµŸÑ ÿ®ŸÜÿß',
                'Name': 'ÿßŸÑÿßÿ≥ŸÖ',
                'Email': 'ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä',
                'Message': 'ÿßŸÑÿ±ÿ≥ÿßŸÑÿ©',
                'Send Message': 'ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ±ÿ≥ÿßŸÑÿ©',
                
                // Chat
                'Energy.AI Assistant': 'ŸÖÿ≥ÿßÿπÿØ Energy.AI',
                'Type your message here...': 'ÿßŸÉÿ™ÿ® ÿ±ÿ≥ÿßŸÑÿ™ŸÉ ŸáŸÜÿß...',
                'Send': 'ÿ•ÿ±ÿ≥ÿßŸÑ',
                
                // Common
                'Search': 'ÿ®ÿ≠ÿ´',
                'Type to search': 'ÿßŸÉÿ™ÿ® ŸÑŸÑÿ®ÿ≠ÿ´',
                'Loading...': 'ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...',
                'Error': 'ÿÆÿ∑ÿ£',
                'Success': 'ŸÜÿ¨ÿ≠',
                'Cancel': 'ÿ•ŸÑÿ∫ÿßÿ°',
                'Save': 'ÿ≠ŸÅÿ∏',
                'Delete': 'ÿ≠ÿ∞ŸÅ',
                'Edit': 'ÿ™ÿπÿØŸäŸÑ',
                'Close': 'ÿ•ÿ∫ŸÑÿßŸÇ'
            },
            en: {
                // Navigation
                'ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©': 'HOME',
                'ÿ≠ŸàŸÑŸÜÿß': 'ABOUT',
                'ÿßŸÑÿÆÿØŸÖÿßÿ™': 'SERVICE',
                'ÿßŸÑÿ™ÿµŸÖŸäŸÖ': 'DESIGN',
                'ÿßÿ™ÿµŸÑ ÿ®ŸÜÿß': 'CONTACT',
                
                // Main content
                'ÿ™ÿµŸÖŸäŸÖ Ÿàÿ™ÿ∑ŸàŸäÿ± ÿßŸÑŸàŸäÿ® ŸÑŸÑÿ∑ÿßŸÇÿ©': 'Web Design & Development Energy',
                'ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä ŸáŸà ÿßŸÑÿ¥ÿ±ÿßÿ±ÿ© ÿßŸÑÿ™Ÿä ÿ™ÿ¥ÿπŸÑ ÿπÿµÿ±ÿßŸã ÿ¨ÿØŸäÿØÿßŸã ŸÖŸÜ ÿßŸÑÿßÿ®ÿ™ŸÉÿßÿ± ŸÅŸä ÿßŸÑÿ∑ÿßŸÇÿ©': 'AI is the spark igniting a new era of energy innovation',
                'ŸÜÿ¥ÿ∫ŸÑ ÿßŸÑÿ∫ÿØ ÿ®ÿ≠ŸÑŸàŸÑ ÿ∞ŸÉŸäÿ© ÿßŸÑŸäŸàŸÖ': 'powering tomorrow with intelligent solutions today',
                'ÿßŸÜÿ∂ŸÖ ÿ•ŸÑŸäŸÜÿß': 'Join Us',
                
                // About section
                'ÿ≠ŸàŸÑ Energy.AI': 'About Energy.AI',
                'Energy.AI ŸÅŸä ÿßŸÑŸÖŸÇÿØŸÖÿ© ŸÑÿØŸÖÿ¨ ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä ŸÖÿπ ÿ≠ŸÑŸàŸÑ ÿßŸÑÿ∑ÿßŸÇÿ©': 'Energy.AI is at the forefront of combining artificial intelligence with energy solutions',
                'ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ∑ÿßŸÇÿ© ÿßŸÑÿ∞ŸÉŸäÿ©': 'Smart Energy Management',
                'ÿ≠ŸÑŸàŸÑ ŸÖÿ≥ÿ™ÿØÿßŸÖÿ©': 'Sustainable Solutions',
                'ÿ±ÿ§Ÿâ ŸÖÿØŸÅŸàÿπÿ© ÿ®ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™': 'Data-Driven Insights',
                
                // Services
                'ÿÆÿØŸÖÿßÿ™ŸÜÿß': 'Our Services',
                'ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑÿ∑ÿßŸÇÿ©': 'Energy Optimization',
                'ÿßŸÑÿµŸäÿßŸÜÿ© ÿßŸÑÿ™ŸÜÿ®ÿ§Ÿäÿ©': 'Predictive Maintenance',
                'ÿ£ŸÖÿßŸÜ ÿßŸÑÿ∑ÿßŸÇÿ©': 'Energy Security',
                'ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ∑ÿßŸÇÿ© ÿßŸÑÿ≥ÿ≠ÿßÿ®Ÿäÿ©': 'Cloud Energy Management',
                
                // Design
                'ŸÜŸáÿ¨ ÿßŸÑÿ™ÿµŸÖŸäŸÖ ŸÑÿØŸäŸÜÿß': 'Our Design Approach',
                'ÿÆÿ±Ÿäÿ∑ÿ© ÿßŸÑÿ∑ÿßŸÇÿ©': 'Energy.map',
                'ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿ¨ÿ∫ÿ±ÿßŸÅŸä ÿßŸÑŸÖŸÉÿßŸÜŸä ÿßŸÑŸÖŸáŸÜŸä': 'Professional Geospatial Intelligence',
                
                // Contact
                'ÿßÿ™ÿµŸÑ ÿ®ŸÜÿß': 'Contact Us',
                'ÿßŸÑÿßÿ≥ŸÖ': 'Name',
                'ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä': 'Email',
                'ÿßŸÑÿ±ÿ≥ÿßŸÑÿ©': 'Message',
                'ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ±ÿ≥ÿßŸÑÿ©': 'Send Message',
                
                // Chat
                'ŸÖÿ≥ÿßÿπÿØ Energy.AI': 'Energy.AI Assistant',
                'ÿßŸÉÿ™ÿ® ÿ±ÿ≥ÿßŸÑÿ™ŸÉ ŸáŸÜÿß...': 'Type your message here...',
                'ÿ•ÿ±ÿ≥ÿßŸÑ': 'Send',
                
                // Common
                'ÿ®ÿ≠ÿ´': 'Search',
                'ÿßŸÉÿ™ÿ® ŸÑŸÑÿ®ÿ≠ÿ´': 'Type to search',
                'ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...': 'Loading...',
                'ÿÆÿ∑ÿ£': 'Error',
                'ŸÜÿ¨ÿ≠': 'Success',
                'ÿ•ŸÑÿ∫ÿßÿ°': 'Cancel',
                'ÿ≠ŸÅÿ∏': 'Save',
                'ÿ≠ÿ∞ŸÅ': 'Delete',
                'ÿ™ÿπÿØŸäŸÑ': 'Edit',
                'ÿ•ÿ∫ŸÑÿßŸÇ': 'Close'
            }
        };
    }

    detectLanguage() {
        // ÿ™ÿ≠ÿØŸäÿØ ÿßŸÑŸÑÿ∫ÿ© ŸÖŸÜ ÿßŸÑÿ™ÿÆÿ≤ŸäŸÜ ÿßŸÑŸÖÿ≠ŸÑŸä ÿ£Ÿà ÿßŸÑŸÖÿ™ÿµŸÅÿ≠
        const savedLanguage = localStorage.getItem('energy-ai-language');
        const browserLanguage = navigator.language || navigator.userLanguage;
        
        if (savedLanguage && this.supportedLanguages.includes(savedLanguage)) {
            this.currentLanguage = savedLanguage;
        } else if (browserLanguage.startsWith('ar')) {
            this.currentLanguage = 'ar';
        } else {
            this.currentLanguage = 'en';
        }
        
        this.applyLanguage();
    }

    setupLanguageToggle() {
        // ÿ•ŸÜÿ¥ÿßÿ° ÿ≤ÿ± ÿ™ÿ®ÿØŸäŸÑ ÿßŸÑŸÑÿ∫ÿ©
        this.createLanguageToggle();
        
        // ÿ•ÿ∂ÿßŸÅÿ© ŸÖÿ≥ÿ™ŸÖÿπŸä ÿßŸÑÿ£ÿ≠ÿØÿßÿ´
        document.addEventListener('click', (e) => {
            if (e.target.closest('.language-toggle')) {
                this.toggleLanguage();
            }
        });
    }

    createLanguageToggle() {
        // ÿßŸÑÿ®ÿ≠ÿ´ ÿπŸÜ ŸÖŸÉÿßŸÜ ÿ•ÿØÿ±ÿßÿ¨ ÿ≤ÿ± ÿßŸÑŸÑÿ∫ÿ©
        const navbar = document.querySelector('.navbar .menu');
        if (!navbar) return;
        
        // ÿ•ŸÜÿ¥ÿßÿ° ÿ≤ÿ± ÿ™ÿ®ÿØŸäŸÑ ÿßŸÑŸÑÿ∫ÿ©
        const languageToggle = document.createElement('div');
        languageToggle.className = 'language-toggle';
        languageToggle.innerHTML = `
            <button class="language-btn" title="ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑŸÑÿ∫ÿ© / Change Language">
                <span class="language-text">${this.currentLanguage.toUpperCase()}</span>
                <ion-icon name="language-outline"></ion-icon>
            </button>
        `;
        
        // ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿ£ŸÜŸÖÿßÿ∑
        this.addLanguageToggleStyles();
        
        // ÿ•ÿØÿ±ÿßÿ¨ ÿßŸÑÿ≤ÿ±
        navbar.appendChild(languageToggle);
    }

    addLanguageToggleStyles() {
        if (document.querySelector('#language-toggle-styles')) return;
        
        const styles = document.createElement('style');
        styles.id = 'language-toggle-styles';
        styles.textContent = `
            .language-toggle {
                margin-left: 15px;
            }
            
            .language-btn {
                background: rgba(255, 114, 0, 0.1);
                border: 1px solid rgba(255, 114, 0, 0.3);
                border-radius: 8px;
                padding: 8px 12px;
                color: #ff7200;
                cursor: pointer;
                transition: all 0.3s ease;
                display: flex;
                align-items: center;
                gap: 5px;
                font-size: 12px;
                font-weight: 500;
            }
            
            .language-btn:hover {
                background: rgba(255, 114, 0, 0.2);
                border-color: #ff7200;
                transform: scale(1.02);
            }
            
            .language-text {
                font-weight: 600;
            }
            
            .language-btn ion-icon {
                font-size: 16px;
            }
            
            @media (max-width: 768px) {
                .language-toggle {
                    margin-left: 10px;
                }
                
                .language-btn {
                    padding: 6px 10px;
                    font-size: 11px;
                }
                
                .language-btn ion-icon {
                    font-size: 14px;
                }
            }
        `;
        
        document.head.appendChild(styles);
    }

    toggleLanguage() {
        // ÿ™ÿ®ÿØŸäŸÑ ÿßŸÑŸÑÿ∫ÿ©
        this.currentLanguage = this.currentLanguage === 'ar' ? 'en' : 'ar';
        
        // ÿ≠ŸÅÿ∏ ÿßŸÑŸÑÿ∫ÿ© ÿßŸÑÿ¨ÿØŸäÿØÿ©
        localStorage.setItem('energy-ai-language', this.currentLanguage);
        
        // ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑŸÑÿ∫ÿ© ÿßŸÑÿ¨ÿØŸäÿØÿ©
        this.applyLanguage();
        
        // ÿ™ÿ≠ÿØŸäÿ´ ÿ≤ÿ± ÿßŸÑŸÑÿ∫ÿ©
        this.updateLanguageToggle();
        
        console.log(`üåê Language changed to: ${this.currentLanguage}`);
    }

    applyLanguage() {
        // ÿ™ÿ∑ÿ®ŸäŸÇ ÿßÿ™ÿ¨ÿßŸá ÿßŸÑŸÜÿµ
        const htmlRoot = document.documentElement;
        if (this.currentLanguage === 'ar') {
            htmlRoot.setAttribute('dir', 'rtl');
            htmlRoot.setAttribute('lang', 'ar');
        } else {
            htmlRoot.setAttribute('dir', 'ltr');
            htmlRoot.setAttribute('lang', 'en');
        }
        
        // ÿ™ÿ±ÿ¨ŸÖÿ© ÿßŸÑŸÜÿµŸàÿµ
        this.translateTexts();
        
        // ÿ™ÿ∑ÿ®ŸäŸÇ ÿ£ŸÜŸÖÿßÿ∑ ÿÆÿßÿµÿ© ÿ®ÿßŸÑŸÑÿ∫ÿ©
        this.applyLanguageStyles();
    }

    translateTexts() {
        const elementsToTranslate = document.querySelectorAll('[data-translate], h1, h2, h3, p, button, a, label, input[placeholder]');
        
        elementsToTranslate.forEach(element => {
            const key = element.getAttribute('data-translate') || element.textContent.trim();
            const translation = this.getTranslation(key);
            
            if (translation && translation !== key) {
                if (element.tagName === 'INPUT' && element.hasAttribute('placeholder')) {
                    element.setAttribute('placeholder', translation);
                } else {
                    element.textContent = translation;
                }
            }
        });
    }

    getTranslation(key) {
        return this.translations[this.currentLanguage]?.[key] || key;
    }

    applyLanguageStyles() {
        const body = document.body;
        
        // ÿ•ÿ≤ÿßŸÑÿ© ŸÅÿ¶ÿßÿ™ ÿßŸÑŸÑÿ∫ÿ© ÿßŸÑÿ≥ÿßÿ®ŸÇÿ©
        body.classList.remove('lang-ar', 'lang-en');
        
        // ÿ•ÿ∂ÿßŸÅÿ© ŸÅÿ¶ÿ© ÿßŸÑŸÑÿ∫ÿ© ÿßŸÑÿ≠ÿßŸÑŸäÿ©
        body.classList.add(`lang-${this.currentLanguage}`);
        
        // ÿ™ÿ∑ÿ®ŸäŸÇ ÿÆÿ∑Ÿàÿ∑ ÿÆÿßÿµÿ© ÿ®ÿßŸÑŸÑÿ∫ÿ© ÿßŸÑÿπÿ±ÿ®Ÿäÿ©
        if (this.currentLanguage === 'ar') {
            this.applyArabicFonts();
        }
    }

    applyArabicFonts() {
        if (document.querySelector('#arabic-fonts')) return;
        
        const arabicFonts = document.createElement('style');
        arabicFonts.id = 'arabic-fonts';
        arabicFonts.textContent = `
            body.lang-ar {
                font-family: 'Tajawal', 'Cairo', 'Amiri', 'Roboto', sans-serif;
            }
            
            body.lang-ar h1, 
            body.lang-ar h2, 
            body.lang-ar h3 {
                font-family: 'Cairo', 'Tajawal', 'Amiri', 'Roboto', sans-serif;
                font-weight: 600;
            }
            
            body.lang-ar .navbar {
                font-family: 'Cairo', 'Tajawal', sans-serif;
            }
        `;
        
        document.head.appendChild(arabicFonts);
        
        // ÿ™ÿ≠ŸÖŸäŸÑ ÿÆÿ∑Ÿàÿ∑ ÿπÿ±ÿ®Ÿäÿ© ÿ•ÿ∂ÿßŸÅŸäÿ©
        this.loadArabicFonts();
    }

    loadArabicFonts() {
        const link = document.createElement('link');
        link.href = 'https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700&family=Tajawal:wght@300;400;500;700&display=swap';
        link.rel = 'stylesheet';
        document.head.appendChild(link);
    }

    updateLanguageToggle() {
        const languageText = document.querySelector('.language-text');
        if (languageText) {
            languageText.textContent = this.currentLanguage.toUpperCase();
        }
    }

    // ÿØŸàÿßŸÑ ŸÖÿ≥ÿßÿπÿØÿ© ŸÑŸÑŸÖÿ∑Ÿàÿ±ŸäŸÜ
    translate(key) {
        return this.getTranslation(key);
    }

    getCurrentLanguage() {
        return this.currentLanguage;
    }

    isRTL() {
        return this.currentLanguage === 'ar';
    }

    addTranslation(language, key, value) {
        if (!this.translations[language]) {
            this.translations[language] = {};
        }
        this.translations[language][key] = value;
    }

    // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ™ÿ±ÿ¨ŸÖÿßÿ™ ÿØŸäŸÜÿßŸÖŸäŸÉŸäÿßŸã
    updateTranslations(newTranslations) {
        Object.keys(newTranslations).forEach(lang => {
            if (this.translations[lang]) {
                Object.assign(this.translations[lang], newTranslations[lang]);
            } else {
                this.translations[lang] = newTranslations[lang];
            }
        });
        
        // ÿ•ÿπÿßÿØÿ© ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ™ÿ±ÿ¨ŸÖÿßÿ™
        this.translateTexts();
    }
}

// ÿ™ŸáŸäÿ¶ÿ© ŸÖÿØŸäÿ± ÿßŸÑŸÑÿ∫ÿßÿ™ ÿπŸÜÿØ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿµŸÅÿ≠ÿ©
document.addEventListener('DOMContentLoaded', function() {
    window.languageManager = new LanguageManager();
});

// ÿ™ÿµÿØŸäÿ± ÿßŸÑŸÅÿ¶ÿ© ŸÑŸÑÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑÿπÿßŸÖ
window.LanguageManager = LanguageManager;
